cpu上下文切换

协程

同步

异步

事件循环

swoole4后一键协程化

#### **特征**

- 不同于普通类库扩展，它直接接管php控制权，进入事件循环，回调到指定函数，程序员仅需处理回调函数；
- 纯C语言编写，异步tcp/udp，redis，mysql；
- 支持websocket；

#### **Swoole对比Golang**

|            | Swoole                     | Golang           |
| ---------- | -------------------------- | ---------------- |
| 线程       | **单线程**，无线程安全问题 | 多线程，支持多核 |
| 偏向       | 业务                       | 中间件           |
| 扩展兼容性 | 部分拓展不兼容             | 语言原生支持协程 |
| 强弱类型   | 弱类型自由灵活             | 强类型，效率高   |

单线程，无线程安全问题；多线程，支持多核

偏向业务；偏向中间件

扩展不支持协程，无法兼容；天生支持协程

弱类型自由灵活；强类型效率高

#### **生命周期**

Master进程：多线程。创建R。

Reactor进程：负责网络连接，收发数据，数据缓冲和拼接拆包。发送数据包和php回调给W。请求处理完成，返回给tcp客户端。

Manager进程：负责创建和回收W和TW进程。

Worker进程：投递任务给TW，响应数据给Manager。

TaskWorker进程：处理异步任务。

**类比**：R可理解为Nginx，W是PHP-FPM。TaskWorker是异步处理队列。

